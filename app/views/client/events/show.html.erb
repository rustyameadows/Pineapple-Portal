<% event_date_range_label = if @event.starts_on.present? && @event.ends_on.present?
                              if @event.starts_on == @event.ends_on
                                @event.starts_on.strftime("%B %-d, %Y")
                              else
                                "#{@event.starts_on.strftime('%B %-d, %Y')} – #{@event.ends_on.strftime('%B %-d, %Y')}"
                              end
                            elsif @event.starts_on.present?
                              @event.starts_on.strftime("%B %-d, %Y")
                            elsif @event.ends_on.present?
                              @event.ends_on.strftime("%B %-d, %Y")
                            else
                              "Dates TBD"
                            end %>
<% event_reference_date = @event.starts_on || @event.ends_on %>
<% event_days_until_label = if event_reference_date.present?
                              days = (event_reference_date.to_date - Time.zone.today).to_i
                              if days.positive?
                                "#{pluralize(days, 'day')} away"
                              elsif days.zero?
                                "Today"
                              else
                                "#{pluralize(days.abs, 'day')} ago"
                              end
                            else
                              "TBD"
                            end %>
<% event_venue_label = @event.location.presence || "Venue TBD" %>
<% event_secondary_location = @event.location_secondary.presence || "TBD" %>

<section class="client-header" id="portal-header">
  <div class="client-container">
    <div class="client-header__grid">
      <div class="client-header__column">
        <p class="client-header__value"><%= event_date_range_label %></p>
        <%= image_tag "hero-divider-line.png", alt: "", class: "client-header__divider" %>
        <p class="client-header__value"><%= event_days_until_label %></p>
      </div>
      <div class="client-header__center">
        <h1 class="client-header__title"><%= @event.name %></h1>
      </div>
      <div class="client-header__column">
        <p class="client-header__value"><%= event_venue_label %></p>
        <%= image_tag "hero-divider-line.png", alt: "", class: "client-header__divider" %>
        <p class="client-header__value"><%= event_secondary_location %></p>
      </div>
    </div>
  </div>
</section>

<section class="client-planning-grid" id="planning-grid">
  <div class="client-container">
    <div class="client-planning-grid__grid">
      <% @module_cards.each do |card| %>
        <% link_attrs = { class: "client-planning-grid__card" } %>
        <% if card[:external] %>
          <% link_attrs[:target] = "_blank" %>
          <% link_attrs[:rel] = "noopener" %>
        <% end %>
        <%= link_to card[:path], **link_attrs do %>
          <h3><%= card[:title] %></h3>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<section class="client-quick-links" id="quick-links">
  <div class="client-container">
    <h2 class="client-quick-links__heading">Useful Event Links</h2>
    <% if @quick_links.any? %>
      <ul class="client-quick-links__list">
        <% @quick_links.each do |link| %>
          <li class="client-quick-links__item">
            <%= link_to link.label, link.url, target: "_blank", rel: "noopener", class: "client-quick-links__link" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="client-quick-links__empty">Your planner hasn’t published any quick links yet.</p>
    <% end %>
  </div>
</section>

<section class="client-planning-team" id="planning-team">
  <div class="client-container">
    <h2 class="client-planning-team__heading">My Planning Team</h2>
    <% if @planning_team_members.any? %>
      <% lead_members, supporting_members = @planning_team_members.partition(&:lead_planner?) %>
      <ul class="client-planning-team__list">
        <% (lead_members + supporting_members).each do |team_member| %>
          <% user = team_member.user %>
          <% item_classes = ["client-planning-team__item"] %>
          <% item_classes << "client-planning-team__item--lead" if team_member.lead_planner? %>
          <li class="<%= item_classes.join(' ') %>" data-role="<%= team_member.lead_planner? ? 'lead' : 'planner' %>">
            <h3 class="client-planning-team__name"><%= user.name %></h3>
            <% if user.title.present? %>
              <p class="client-planning-team__title"><%= user.title %></p>
            <% end %>
            <ul class="client-planning-team__contact">
              <% if user.phone_number.present? %>
                <li><%= user.phone_number %></li>
              <% end %>
              <li><%= mail_to user.email %></li>
            </ul>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="client-planning-team__empty">Your planning team will appear here once your planner publishes their contact details.</p>
    <% end %>
  </div>
</section>

<%= render "client/shared/footer" %>
