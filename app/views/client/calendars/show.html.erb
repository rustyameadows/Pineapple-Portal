<section class="client-page client-page--calendar">
  <header class="client-page__header">
    <h1><%= @active_view.name %></h1>
    <p><%= @active_view.description %></p>
    <p class="client-calendar__meta">Times shown in <strong><%= @timezone_label %></strong>.</p>
    <% if @active_view.hide_locked? %>
      <p class="client-calendar__note">Locked items are hidden in this view.</p>
    <% end %>
  </header>

  <% if @items.any? %>
    <table class="client-table client-calendar__table">
      <thead>
        <tr>
          <th>When</th>
          <th>Item</th>
          <th>Tags</th>
          <th>Duration</th>
        </tr>
      </thead>
      <tbody>
        <% @items.each do |item| %>
          <% when_label = calendar_item_time_label_with_marker(item, @calendar.timezone) %>
          <% anchor_label = calendar_item_relative_label(item) %>
          <% duration_label = calendar_item_duration_label(item) %>
          <% detail_lines = [] %>
          <% detail_lines << "Vendor: #{item.vendor_name}" if item.vendor_name.present? %>
          <% detail_lines << "Location: #{item.location_name}" if item.location_name.present? %>
          <% detail_lines << "Status: #{item.status.titleize}" unless item.status == "planned" %>
        <tr class="client-calendar__row <%= calendar_item_row_classes(item) %>">
          <td class="client-calendar__when"><%= when_label %></td>
          <td class="client-calendar__details">
            <div class="client-calendar__title">
              <strong><%= item.title %></strong>
              <% if item.locked? %>
                <span class="client-calendar__badge">Locked</span>
              <% end %>
            </div>
          <% if anchor_label %>
            <p class="client-calendar__anchor"><%= anchor_label %></p>
          <% end %>
              <% detail_lines.each do |line| %>
                <p class="client-calendar__meta-line"><%= line %></p>
              <% end %>
              <% if item.notes.present? %>
                <div class="client-calendar__notes"><%= simple_format(item.notes) %></div>
              <% end %>
            </td>
            <td class="client-calendar__tags">
              <% if item.event_calendar_tags.any? %>
                <div class="client-calendar__tag-list">
                  <% item.event_calendar_tags.each do |tag| %>
                    <span class="client-calendar__tag-pill" style="<%= calendar_tag_style(tag) %>"><%= tag.name %></span>
                  <% end %>
                </div>
              <% else %>
                <span class="client-calendar__tag-pill client-calendar__tag-pill--empty">â€”</span>
              <% end %>
            </td>
            <td class="client-calendar__duration"><%= duration_label %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="client-placeholder">
      <p>No schedule items are available for this view yet. Check back soon!</p>
    </div>
  <% end %>
</section>
