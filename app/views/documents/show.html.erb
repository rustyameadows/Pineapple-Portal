<h1><%= @document.title %> (v<%= @document.version %>)</h1>

<p>Event: <%= link_to @event.name, event_path(@event) %></p>
<p>Logical ID: <%= @document.logical_id %></p>
<p>Latest version: <%= @document.is_latest? ? "Yes" : "No" %></p>
<p>Content type: <%= @document.content_type %></p>
<p>Size: <%= number_to_human_size(@document.size_bytes) %></p>
<p>Storage key: <code><%= @document.storage_uri %></code></p>
<p>Checksum: <code><%= @document.checksum %></code></p>

<p>
  <%= link_to "Download this version", download_event_document_path(@event, @document) %>
  <% if @document.is_latest? %>
    (latest)
  <% else %>
    | <%= link_to "Download latest version", download_event_document_path(@event, @versions.first) %>
  <% end %>
</p>

<section>
  <h2>Version history</h2>
  <table>
    <thead>
      <tr>
        <th>Version</th>
        <th>Uploaded</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @versions.each do |version| %>
        <tr>
          <td>v<%= version.version %></td>
          <td><%= version.created_at&.to_fs(:long) || "—" %></td>
          <td>
            <% if version == @document %>
              Viewing
            <% else %>
              <%= link_to "View", event_document_path(@event, version) %>
            <% end %>
            |
            <%= link_to "Download", download_event_document_path(@event, version) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</section>

<p>
  <%= link_to "Upload new version", new_event_document_path(@event, logical_id: @document.logical_id) %> |
  <%= link_to "Edit", edit_event_document_path(@event, @document) %> |
  <%= button_to "Delete", event_document_path(@event, @document), method: :delete, data: { confirm: "Delete this document?" } %>
</p>

<section>
  <h2>Attachments</h2>
  <%= render "attachments/list", attachments: @attachments %>
</section>

<section>
  <h2>Attach to…</h2>
  <% if @available_entities.any? %>
    <% @available_entities.each do |entity| %>
      <h3><%= entity_label(entity) %></h3>
      <%= render "attachments/form", entity: entity, documents: documents_for_entity(entity) %>
    <% end %>
  <% else %>
    <p>No available entities to attach.</p>
  <% end %>
</section>

<% content_for :scripts do %>
  <%= render "attachments/upload_script" %>
<% end %>
