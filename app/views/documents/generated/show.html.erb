<% provide :page_shell do %>
  <div class="event-layout">
    <%= render "events/sidebar_navigation", event: @event %>

    <div class="event-layout__main">
      <%= render "shared/flash" %>

      <section class="event-section generated-builder">
        <header class="event-section__header generated-builder__header">
          <div>
            <p class="event-section__eyebrow">Generated document</p>
            <h1 class="event-section__title"><%= @document.title %></h1>
            <% if @latest_version.present? && @latest_version.storage_uri.present? %>
              <p class="event-section__meta">Last compiled <%= @latest_version.updated_at.to_fs(:long) %> Â· version <%= @latest_version.version %></p>
            <% else %>
              <p class="event-section__meta">No compiled version yet.</p>
            <% end %>
          </div>
          <div class="generated-builder__actions">
            <%= link_to "Back to documents", event_documents_path(@event), class: "button button--ghost" %>
            <%= button_to "Compile (coming soon)",
                          compile_event_documents_generated_path(@event, @document.logical_id),
                          method: :post,
                          class: "button button--primary",
                          disabled: true %>
          </div>
        </header>

        <div class="generated-builder__body generated-builder__single-column">
          <%= render "documents/generated/segment_list",
                     event: @event,
                     document: @document,
                     segments: @segments,
                     available_pdf_documents: @available_pdf_documents,
                     available_html_views: @available_html_views %>

          <div class="generated-builder__workspace-card">
            <h2>Compiled versions</h2>
            <% if @compiled_versions.any? %>
              <ul class="generated-builder__versions">
                <% @compiled_versions.each do |version| %>
                  <li>
                    <div>
                      <strong>Version <%= version.version %></strong>
                      <span class="generated-builder__version-sub">
                        Compiled <%= version.updated_at.to_fs(:long) %>
                      </span>
                    </div>
                    <%= link_to "Download",
                                download_event_document_path(@event, version),
                                class: "button button--ghost button--tiny" %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="generated-builder__empty">We will list compiled versions here once the first build runs.</p>
            <% end %>
          </div>
        </div>
      </section>
    </div>
  </div>
<% end %>
