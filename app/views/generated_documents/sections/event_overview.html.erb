<% if local_assigns.fetch(:render_base_styles, true) %>
  <%= render "generated_documents/sections/base_styles" %>
<% end %>

<%= render "generated_documents/sections/page_header", segment: @segment %>

<style>
  .generated-template--event-overview {
    align-content: start;
    gap: 1.5rem;
    font-size: 0.95rem;
    --generated-document-content-padding-x: 0.15in;
    --generated-document-content-padding-top: 1in;
    --generated-document-content-padding-bottom: 1in;
  }

  .generated-template--event-overview__section {
    display: grid;
    gap: 0.6rem;
  }

  .generated-template--event-overview__section-label {
    margin: 0;
    padding: 0.4rem 0.65rem;
    background: color-mix(in srgb, var(--color-sea-foam) 25%, white);
    border-radius: 0.35rem;
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: var(--font-weight-semibold, 600);
    color: var(--color-dark-brown);
  }

  .generated-template--event-overview__section-body {
    margin: 0;
    color: var(--color-dark-brown);
    line-height: 1.5;
  }

  .generated-template--event-overview__vendor-table {
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
  }

  .generated-template--event-overview__vendor-table th,
  .generated-template--event-overview__vendor-table td {
    text-align: left;
    padding: 0.55rem 0.65rem;
    border-bottom: 1px solid rgba(45, 28, 18, 0.08);
    vertical-align: top;
  }

  .generated-template--event-overview__vendor-table th {
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(45, 28, 18, 0.75);
  }

  .generated-template--event-overview__vendor-type {
    font-weight: 600;
  }

  .generated-template--event-overview__vendor-stack {
    display: grid;
    gap: 0.2rem;
  }

  .generated-template--event-overview__vendor-name {
    font-weight: 600;
  }

  .generated-template--event-overview__vendor-social {
    font-weight: 600;
    color: rgba(45, 28, 18, 0.85);
  }

  .generated-template--event-overview__empty {
    font-style: italic;
    color: rgba(45, 28, 18, 0.65);
    margin: 0;
  }
</style>

<div class="generated-template generated-template--event-overview">
  <% sections = [
    "Important Information",
    "Timeline",
    "Planner Contact",
    "Vendor Contacts",
    "Social Media",
    "Arriving at the Venue",
    "Deliveries",
    "Other"
  ] %>

  <%
    venue_rows = @event.event_venues.ordered.flat_map do |venue|
      contacts = venue.contacts.presence || [{}]
      contacts.map do |contact|
        contact_hash = contact.to_h

        {
          type: "Venue",
          vendor_name: venue.name,
          contact_name: contact_hash["name"].presence,
          social_handle: nil,
          contact_email: contact_hash["email"].presence,
          contact_phone: contact_hash["phone"].presence
        }
      end
    end

    vendor_rows = @event.event_vendors.ordered.flat_map do |vendor|
      contacts = vendor.contacts.presence || [{}]
      contacts.map do |contact|
        contact_hash = contact.to_h
        social_handle = vendor.social_handle.to_s.strip.presence

        {
          type: vendor.vendor_type.presence || "Vendor",
          vendor_name: vendor.name,
          contact_name: contact_hash["name"].presence,
          social_handle: social_handle,
          contact_email: contact_hash["email"].presence,
          contact_phone: contact_hash["phone"].presence
        }
      end
    end

    all_vendor_rows = venue_rows + vendor_rows
  %>

  <% sections.each do |title| %>
    <section class="generated-template--event-overview__section">
      <h2 class="generated-template--event-overview__section-label"><%= title %></h2>
      <% if title == "Vendor Contacts" %>
        <% if all_vendor_rows.any? %>
          <table class="generated-template--event-overview__vendor-table">
            <thead>
              <tr>
                <th scope="col">Vendor Type</th>
                <th scope="col">Contact</th>
                <th scope="col">Social</th>
              </tr>
            </thead>
            <tbody>
              <% all_vendor_rows.each do |row| %>
                <tr>
                  <td class="generated-template--event-overview__vendor-type"><%= row[:type] %></td>
                  <td>
                    <div class="generated-template--event-overview__vendor-stack">
                      <span class="generated-template--event-overview__vendor-name"><%= row[:vendor_name] %></span>
                      <% if row[:contact_name].present? %>
                        <span><%= row[:contact_name] %></span>
                      <% else %>
                        <span>—</span>
                      <% end %>
                    </div>
                  </td>
                  <td>
                    <% if row[:social_handle].present? %>
                      <span class="generated-template--event-overview__vendor-social"><%= row[:social_handle] %></span>
                    <% else %>
                      <span>—</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p class="generated-template--event-overview__empty">Vendor list coming soon.</p>
        <% end %>
      <% else %>
        <p class="generated-template--event-overview__section-body">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin sed lorem nec justo interdum gravida. Donec vel nisl vitae tortor tincidunt eleifend.
        </p>
      <% end %>
    </section>
  <% end %>
</div>
